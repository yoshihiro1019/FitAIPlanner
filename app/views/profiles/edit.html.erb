<div class="container pt-3">
  <div class="row">
    <div class="col-md-10 offset-md-1">
      <h1 class="float-left mb-5"><%= t(".title") %></h1>
      <div class="form-container">
        <% flash.each do |key, value| %>
          <div class="alert alert-<%= key == 'notice' ? 'success' : 'danger' %>">
            <%= value %>
          </div>
        <% end %>
        <%= form_with(model: @user, url: profile_path, local: true, html: { multipart: true }) do |f| %>
          <%= render 'shared/error_messages', object: f.object %>
          <div class="mb-3">
            <%= f.label :email %>
            <%= f.text_field :email, class: "form-control" %>
          </div>
          <div class="mb-3">
            <%= f.label :last_name %>
            <%= f.text_field :last_name, class: "form-control" %>
          </div>
          <div class="mb-3">
            <%= f.label :first_name %>
            <%= f.text_field :first_name, class: "form-control" %>
          </div>
          <div class="mb-3">
            <%= f.label :address, '住所（任意）' %>
            <%= f.text_field :address, class: 'form-control' %>
          </div>
          <div class="mb-3">
            <%= f.label :avatar, 'アバター' %>
            <%= f.file_field :avatar, class: "form-control", accept: 'image/*' %>
            <%= f.hidden_field :avatar_cache %>
          </div>
          <div class="mb-3">
            <img id="avatarPreview" src="<%= @user.avatar.present? ? @user.avatar.url : asset_path('default_avatar.png') %>" alt="Avatar Preview" class="rounded-circle" width="100" height="100">
          </div>
          <%= f.submit t('helpers.submit.update'), class: "btn btn-primary" %>
        <% end %>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  var fileInput = document.querySelector("input[type=file]");
  var avatarPreview = document.getElementById("avatarPreview");

  fileInput.addEventListener("change", function() {
    var file = fileInput.files[0];
    if (file) {
      var reader = new FileReader();
      reader.onload = function(e) {
        avatarPreview.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }
  });
});
</script>
